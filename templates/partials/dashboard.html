<div class="grid">
  <div class="card highlight">
    <div class="card-title">Bem-vindo</div>
    <p>Use o menu ao lado para navegar. Itens carregam sem sair da Home.</p>
    {% if ped_dotacao_missing %}
      <p class="text-error">Controle de Dota&#231;&#227;o do PED n&#227;o encontrado: {{ ped_dotacao_missing | join(', ') }}</p>
    {% endif %}
    {% if emp_planejamento_missing_lines %}
      <p class="text-error">Chave do Planejamento n&#227;o identificada (n&#186; da linha): {{ emp_planejamento_missing_lines | join(', ') }}</p>
    {% endif %}
    {% if emp_dotacao_missing %}
      <p class="text-error">Controle de Dota&#231;&#227;o do EMP n&#227;o encontrado: {{ emp_dotacao_missing | join(', ') }}</p>
    {% endif %}
  </div>
  <div class="card">
    <div class="card-title">Status</div>
    <p>Ambiente conectado. Verifique permissoes para acessar usuarios.</p>
    {% if can_view_sessions %}
      <hr>
      <div class="muted">Usu&aacute;rios logados agora: {{ active_sessions|length }}</div>
      {% if active_sessions %}
        <ul class="muted" style="margin-top:6px;">
          {% for s in active_sessions %}
            <li>{{ s.nome }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="muted" style="margin-top:6px;">Nenhum usuario logado no momento.</div>
      {% endif %}
    {% endif %}
  </div>
  <div class="card">
    <div class="card-title">Proximos passos</div>
    <ul>
      <li>Completar telas do MVP</li>
      <li>Configurar regras por perfil</li>
      <li>Adicionar indicadores do dashboard</li>
    </ul>
  </div>
</div>

<div id="dotacao-aguardando-modal" class="modal-overlay" data-has-items="{{ 1 if (dotacoes_aguardando or estornos_aguardando) else 0 }}" style="display:none;">
  <div class="modal-card">
    <div class="modal-header">
      <img src="/static/img/logo.jpg" alt="Logo" class="modal-logo" />
      <div class="modal-header-text">
        <div class="modal-header-title">Sistema de Planejamento e Or&#231;amento</div>
        <div class="modal-header-subtitle">SPO-NGER-SEDUCMT</div>
      </div>
    </div>
    <div class="modal-body">
      <div class="modal-title">Dota&#231;&#245;es Aguardando Aprova&#231;&#227;o</div>
      {% if dotacoes_aguardando %}
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Controle de Dota&#231;&#227;o</th>
                <th>Valor da Dota&#231;&#227;o</th>
                <th>Status</th>
                <th>Aprovar por</th>
              </tr>
            </thead>
            <tbody>
              {% for d in dotacoes_aguardando %}
                <tr>
                  <td>{{ d.chave_dotacao }}</td>
                  <td>{{ d.valor_atual }}</td>
                  <td>{{ d.status_aprovacao }}</td>
                  <td>{{ d.adj_concedente }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="muted">Nenhuma dota&#231;&#227;o aguardando.</div>
      {% endif %}
      <div class="modal-title" style="margin-top:16px;">Estornos Aguardando Aprova&#231;&#227;o</div>
      {% if estornos_aguardando %}
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Controle de Dota&#231;&#227;o</th>
                <th>Valor do Estorno</th>
                <th>Status</th>
                <th>Aprovar por</th>
              </tr>
            </thead>
            <tbody>
              {% for e in estornos_aguardando %}
                <tr>
                  <td>{{ e.chave_dotacao }}</td>
                  <td>{{ e.valor_estorno }}</td>
                  <td>{{ e.status_aprovacao }}</td>
                  <td>{{ e.adj_solicitante }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="muted">Nenhum estorno aguardando.</div>
      {% endif %}
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary sm" type="button" id="dotacao-aguardando-close">Fechar</button>
    </div>
  </div>
</div>
